WITH age_group_mapping AS (SELECT age, TRIM(ten_year_interval) AS age_group FROM dim_age_group), sentinel_data AS (SELECT se.client_id, c.gender, c.birth_date, se.hiv_diagnosis_date, SUBSTR(se.hiv_diagnosis_date, -4) AS year, se.enrolment_date, se.first_art_date, se.first_art_drugs, se.last_art_date, se.last_art_drugs, se.last_viral_load_result_is_not_suppressed, se.last_viral_load_date, se.last_viral_load_result_text, se.has_ever_been_initiated_on_art, ag.age_group FROM fact_sentinel_event se INNER JOIN dim_client c ON se.client_id = c.client_id INNER JOIN age_group_mapping ag ON c.current_age = ag.age WHERE c.birth_date >= $[start_date%d] AND c.birth_date < $[end_date%d]) SELECT client_id, gender, birth_date, hiv_diagnosis_date, enrolment_date, first_art_date, first_art_drugs, last_art_date, last_art_drugs, last_viral_load_date, last_viral_load_result_text FROM sentinel_data WHERE last_viral_load_result_is_not_suppressed = 1