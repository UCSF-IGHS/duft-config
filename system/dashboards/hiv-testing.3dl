<TabSet>

    <Tab title="Testing Cascade">
        <Dashboard>
            <Grid>
                <Dataset query="SELECT 'May 27, 24 - Jun 02, 24' AS week_dates, 'Ngomamtimba Hospital' AS facility_name">
                    <Row columns="2" smallColumns="1">
                        <Header>
                            <DataString>Key Performance Indicators</DataString>
                        </Header>
                        <Header small="true">
                            <DataString>%facility_name%</DataString>
                        </Header>
                    </Row>
                </Dataset>

                <Filters>
                    <Filter caption="Reporting Week" name="week" values_query={`SELECT DISTINCT weekly_start_monday_day_dates AS label, weekly_start_monday_end_date AS value FROM derived.dim_date ORDER BY weekly_start_monday_end_date DESC;`}/>
                </Filters>
                <Row columns="1">
                    <Dataset query="">
                      <CascadeChart
                        header="HIV Case Identification Cascade"
                        subHeader="Visual representation of HIV case identification metrics."
                        cascadeObject={{
                          id: "1",
                          data: {
                            label: "Clients Tested for HIV",
                            query:
                              "SELECT f.hts_client_code AS [HTS Client Code], hts_age_at_test AS Age, hts_sex_code AS Sex, hiv_test_date AS [Test Date], hiv_testing_point AS [Testing Point], hts_attendance_type AS [Attendance Type], hts_ctc_id AS [CTC ID] FROM derived.fact_hiv_testing f INNER JOIN derived.dim_hts_client c ON f.hts_client_id = c.hts_client_id INNER JOIN derived.dim_date d ON f.hiv_test_date = d.[date] WHERE is_valid_hiv_test = 1 AND d.weekly_start_monday_end_date = COALESCE(NULLIF('$week', ''), '2024-06-02');",
                          },
                          options: {
                                nodeBGColorHover: "#6699cc",
                                borderColorHover: "#517ca1",
                                nodeBGColor: "#cce7ff",
                          },
                          children: [
                            {
                                id: "11",
                                data: {
                                    label: "Clients Tested Positive",
                                    query:
                                    "SELECT f.hts_client_code AS [HTS Client Code], hts_age_at_test AS Age, hts_sex_code AS Sex, hiv_test_date AS [Test Date], hiv_testing_point AS [Testing Point], hts_attendance_type AS [Attendance Type], hts_ctc_id AS [CTC ID] FROM derived.fact_hiv_testing f INNER JOIN derived.dim_hts_client c ON f.hts_client_id = c.hts_client_id INNER JOIN derived.dim_date d ON f.hiv_test_date = d.[date] WHERE is_hiv_positive = 1 AND d.weekly_start_monday_end_date = COALESCE(NULLIF('$week', ''), '2024-06-02');",
                                },
                                options: {
                                    nodeBGColorHover: "#6699cc",
                                    borderColorHover: "#517ca1",
                                    nodeBGColor: "#cce7ff",
                                },
                                children: [
                                {
                                    id: "111",
                                    data: {
                                        label: "With Documented CTC ID",
                                        query:
                                        "SELECT f.hts_client_code AS [HTS Client Code], hts_age_at_test AS Age, hts_sex_code AS Sex, hiv_test_date AS [Test Date], hiv_testing_point AS [Testing Point], hts_attendance_type AS [Attendance Type], hts_ctc_id AS [CTC ID] FROM derived.fact_hiv_testing f INNER JOIN derived.dim_hts_client c ON f.hts_client_id = c.hts_client_id INNER JOIN derived.dim_date d ON f.hiv_test_date = d.[date] WHERE is_hiv_positive = 1 AND hts_ctc_id IS NOT NULL AND d.weekly_start_monday_end_date = COALESCE(NULLIF('$week', ''), '2024-06-02');",
                                    },
                                    options: {
                                        nodeBGColorHover: "#6699cc",
                                        borderColorHover: "#517ca1",
                                        nodeBGColor: "#cce7ff",
                                    },
                                },
                                {
                                    id: "112",
                                    data: {
                                        label: "Without Documented CTC ID",
                                        query:
                                        "SELECT f.hts_client_code AS [HTS Client Code], hts_age_at_test AS Age, hts_sex_code AS Sex, hiv_test_date AS [Test Date], hiv_testing_point AS [Testing Point], hts_attendance_type AS [Attendance Type], hts_ctc_id AS [CTC ID] FROM derived.fact_hiv_testing f INNER JOIN derived.dim_hts_client c ON f.hts_client_id = c.hts_client_id INNER JOIN derived.dim_date d ON f.hiv_test_date = d.[date] WHERE is_hiv_positive = 1 AND hts_ctc_id IS NULL AND d.weekly_start_monday_end_date = COALESCE(NULLIF('$week', ''), '2024-06-02');",
                                    },
                                    options: {
                                        nodeBGColorHover: "#6699cc",
                                        borderColorHover: "#517ca1",
                                        nodeBGColor: "#cce7ff",
                                    },
                                },
                                ],
                            },
                            {
                                id: "12",
                                data: {
                                    label: "Clients Tested Negative",
                                    query:
                                    "SELECT f.hts_client_code AS [HTS Client Code], hts_age_at_test AS Age, hts_sex_code AS Sex, hiv_test_date AS [Test Date], hiv_testing_point AS [Testing Point], hts_attendance_type AS [Attendance Type], hts_ctc_id AS [CTC ID] FROM derived.fact_hiv_testing f INNER JOIN derived.dim_hts_client c ON f.hts_client_id = c.hts_client_id INNER JOIN derived.dim_date d ON f.hiv_test_date = d.[date] WHERE is_hiv_negative = 1 AND d.weekly_start_monday_end_date = COALESCE(NULLIF('$week', ''), '2024-06-02')",
                                },
                                options: {
                                    nodeBGColorHover: "#6699cc",
                                    borderColorHover: "#517ca1",
                                    nodeBGColor: "#cce7ff",
                              },
                            },
                          ],
                        }}
                      />
                    </Dataset>
                  </Row>
            </Grid>
        </Dashboard>
    </Tab>

    <Tab title="Testing Table">
        <Dashboard>
            <Grid>
                <Row>
                    <Header>HIV Case Identification</Header>
                </Row>
                <Filters>
                    <Filter caption="Reporting Week" name="week" values_query={`SELECT DISTINCT weekly_start_monday_day_dates AS label, weekly_start_monday_end_date AS value FROM derived.dim_date ORDER BY weekly_start_monday_end_date DESC;`}/>
                </Filters>

                <Row columns="1" largeColumns="1">
                    <Dataset pageSize='20' searchColumns="hts_age_at_test, hts_sex_code" query={`SELECT f.hts_client_code AS [HTS Client Code], hts_age_at_test AS Age, hts_sex_code AS Sex, hiv_test_date AS [Test Date], hiv_testing_point AS [Testing Point], hiv_test_result AS [Test Result], hts_attendance_type AS [Attendance Type], visit_type AS [Visit Type], hts_ctc_id AS [CTC ID] FROM derived.fact_hiv_testing f INNER JOIN derived.dim_hts_client c ON f.hts_client_id = c.hts_client_id INNER JOIN derived.dim_date d ON f.hiv_test_date = d.[date] WHERE is_valid_hiv_test = 1 AND d.weekly_start_monday_end_date = COALESCE(NULLIF('$week', ''), '2024-06-02') ORDER BY f.hts_client_code`}>
                        <InfiniteScrollTable header="HIV Case Identification Table" subHeader="Tabular representation of HIV case identification metrics." variant="plain" searchHint="age, sex" exportData="true" />
                    </Dataset>
                </Row>
            </Grid>
        </Dashboard>
    </Tab>

</TabSet>